# Troubleshooting Flowise SSL Certificate Issues on Coolify (v4.0.0-beta.397)

## Problem
Flowise deployed on Coolify runs but accessing its URL results in an **Invalid SSL certificate Error code 526 error**.

## Initial Docker Compose Configuration
```yaml
services:
  flowise:
    image: 'flowiseai/flowise:latest'
    environment:
      - SERVICE_FQDN_FLOWISE_3001
      - 'DEBUG=${DEBUG:-false}'
      - 'DISABLE_FLOWISE_TELEMETRY=${DISABLE_FLOWISE_TELEMETRY:-true}'
      - 'PORT=${PORT:-3001}'
      - DATABASE_PATH=/root/.flowise
      - APIKEY_PATH=/root/.flowise
      - SECRETKEY_PATH=/root/.flowise
      - LOG_PATH=/root/.flowise/logs
      - BLOB_STORAGE_PATH=/root/.flowise/storage
      - 'FLOWISE_USERNAME=${SERVICE_USER_FLOWISE}'
      - 'FLOWISE_PASSWORD=${SERVICE_PASSWORD_FLOWISE}'
    volumes:
      - 'flowise-data:/root/.flowise'
    healthcheck:
      test:
        - CMD-SHELL
        - 'wget -qO- http://127.0.0.1:3001 || exit 1'
      interval: 5s
      timeout: 5s
      retries: 3
```

## Environment Variables in Coolify
The Coolify environment variables showed:
- DEBUG
- DISABLE_FLOWISE_TELEMETRY
- PORT (set to 3001)
- SERVICE_FQDN_FLOWISE (set to https://flowise.your-domain.com)
- SERVICE_PASSWORD_FLOWISE
- SERVICE_USER_FLOWISE

## Actual Deployed Docker Compose (Generated by Coolify)
```yaml
services:
  flowise:
    image: 'flowiseai/flowise:latest'
    environment:
      DEBUG: '${DEBUG:-false}'
      DISABLE_FLOWISE_TELEMETRY: '${DISABLE_FLOWISE_TELEMETRY:-true}'
      PORT: '${PORT:-3001}'
      DATABASE_PATH: /root/.flowise
      APIKEY_PATH: /root/.flowise
      SECRETKEY_PATH: /root/.flowise
      LOG_PATH: /root/.flowise/logs
      BLOB_STORAGE_PATH: /root/.flowise/storage
      FLOWISE_USERNAME: '${SERVICE_USER_FLOWISE}'
      FLOWISE_PASSWORD: '${SERVICE_PASSWORD_FLOWISE}'
      SERVICE_USER_FLOWISE: [username]
      SERVICE_PASSWORD_FLOWISE: [password]
      COOLIFY_RESOURCE_UUID: b4kwwoww0880ks0wsw8ckcco
      COOLIFY_CONTAINER_NAME: flowise-b4kwwoww0880ks0wsw8ckcco
      COOLIFY_URL: 'https://flowise.your-domain.com:3001'
      COOLIFY_FQDN: 'flowise.your-domain.com:3001'
    ports:
      - '3001:3001'
    volumes:
      - 'b4kwwoww0880ks0wsw8ckcco_flowise-data:/root/.flowise'
    healthcheck:
      test:
        - CMD-SHELL
        - 'wget -qO- http://127.0.0.1:3001 || exit 1'
      interval: 5s
      timeout: 5s
      retries: 3
    container_name: flowise-b4kwwoww0880ks0wsw8ckcco
    restart: unless-stopped
    labels:
      - coolify.managed=true
      - coolify.version=4.0.0-beta.397
      - coolify.serviceId=20
      - coolify.type=service
      - coolify.name=flowise-b4kwwoww0880ks0wsw8ckcco
      - coolify.resourceName=flowise-ai-automation
      - coolify.projectName=flowise-ai-automation
      - coolify.serviceName=flowise
      - coolify.environmentName=production
      - coolify.pullRequestId=0
      - coolify.service.subId=88
      - coolify.service.subType=application
      - coolify.service.subName=flowise
      - traefik.enable=true
      - traefik.http.middlewares.gzip.compress=true
      - traefik.http.middlewares.redirect-to-https.redirectscheme.scheme=https
      - traefik.http.routers.http-0-b4kwwoww0880ks0wsw8ckcco-flowise.entryPoints=http
      - traefik.http.routers.http-0-b4kwwoww0880ks0wsw8ckcco-flowise.middlewares=redirect-to-https
      - 'traefik.http.routers.http-0-b4kwwoww0880ks0wsw8ckcco-flowise.rule=Host(`flowise.your-domain.com`) && PathPrefix(`/`)'
      - traefik.http.routers.http-0-b4kwwoww0880ks0wsw8ckcco-flowise.service=http-0-b4kwwoww0880ks0wsw8ckcco-flowise
      - traefik.http.routers.https-0-b4kwwoww0880ks0wsw8ckcco-flowise.entryPoints=https
      - traefik.http.routers.https-0-b4kwwoww0880ks0wsw8ckcco-flowise.middlewares=gzip
      - 'traefik.http.routers.https-0-b4kwwoww0880ks0wsw8ckcco-flowise.rule=Host(`flowise.your-domain.com`) && PathPrefix(`/`)'
      - traefik.http.routers.https-0-b4kwwoww0880ks0wsw8ckcco-flowise.service=https-0-b4kwwoww0880ks0wsw8ckcco-flowise
      - traefik.http.routers.https-0-b4kwwoww0880ks0wsw8ckcco-flowise.tls.certresolver=letsencrypt
      - traefik.http.routers.https-0-b4kwwoww0880ks0wsw8ckcco-flowise.tls=true
      - traefik.http.services.http-0-b4kwwoww0880ks0wsw8ckcco-flowise.loadbalancer.server.port=3001
      - traefik.http.services.https-0-b4kwwoww0880ks0wsw8ckcco-flowise.loadbalancer.server.port=3001
      - 'caddy_0.encode=zstd gzip'
      - 'caddy_0.handle_path.0_reverse_proxy={{upstreams 3001}}'
      - 'caddy_0.handle_path=/*'
      - caddy_0.header=-Server
      - 'caddy_0.try_files={path} /index.html /index.php'
      - 'caddy_0=https://flowise.your-domain.com'
      - caddy_ingress_network=b4kwwoww0880ks0wsw8ckcco
    networks:
      b4kwwoww0880ks0wsw8ckcco: null
volumes:
  flowise-data:
    driver: local
  b4kwwoww0880ks0wsw8ckcco_flowise-data:
    name: b4kwwoww0880ks0wsw8ckcco_flowise-data
networks:
  b4kwwoww0880ks0wsw8ckcco:
    name: b4kwwoww0880ks0wsw8ckcco
    external: true
configs: {  }
secrets: {  }
```

## Root Cause of the Issue
The SSL certificate error (Error code 526) was caused by a mismatch between how the domain was configured and how it was being accessed:

1. The SSL certificate was configured for the domain name without the port
2. But the URL configuration included the port: 
   ```
   COOLIFY_URL: 'https://flowise.your-domain.com:3001'
   COOLIFY_FQDN: 'flowise.your-domain.com:3001'
   ```
3. However, the Traefik and Caddy configurations were set up for the domain without the port:
   ```
   'caddy_0=https://flowise.your-domain.com'
   ```

## Solution
The solution was to update the environment variables to remove the port from the domain:

```yaml
COOLIFY_URL: 'https://flowise.your-domain.com'  # Remove :3001
COOLIFY_FQDN: 'flowise.your-domain.com'  # Remove :3001
```

After making these changes and redeploying, the application could be accessed properly using `https://flowise.your-domain.com` (without the port in the URL).

## Key Takeaways
1. When using SSL certificates with Coolify, ensure domain configuration is consistent throughout all settings
2. SSL certificates are typically issued for domains without ports, so including a port in the URL can cause validation failures
3. Check for mismatches between the domain in environment variables and in proxy configurations
4. The URL used to access the application must match exactly what the SSL certificate was issued for
